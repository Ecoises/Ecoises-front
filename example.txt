pages 

import { useEffect, useState } from "react";
import { useParams, Link, useNavigate } from "react-router-dom";
import { motion } from "framer-motion";
import { Button } from "@/components/ui/button";
import { 
  Clock, 
  Tag, 
  ChevronLeft, 
  BookOpen, 
  Trophy, 
  PlayCircle, 
  CheckCircle2,
  Users,
  Star,
  Award
} from "lucide-react";
import { CourseProgress } from "@/components/learn/CourseProgress";
import { LessonCard } from "@/components/learn/LessonCard";

// Types - these would come from your API service
interface Lesson {
  id: number;
  title: string;
  estimated_duration: number;
}

interface Category {
  id: number;
  name: string;
}

interface Author {
  full_name: string;
  avatar?: string;
}

interface CourseDetails {
  goals?: string[];
  completion_points?: number;
}

interface ArticleDetails {
  content_text?: string;
}

interface EducationalContent {
  slug: string;
  title: string;
  description: string;
  thumbnail_url?: string;
  estimated_duration: number;
  difficulty_level: string;
  categories?: Category[];
  lessons?: Lesson[];
  author?: Author;
  course_details?: CourseDetails;
  article_details?: ArticleDetails;
  enrollment?: {
    progress_percentage: number;
  };
  lesson_progress?: Record<number, { status: string }>;
}

// Mock data for demo purposes
const mockCourse: EducationalContent = {
  slug: "biodiversidad-ecosistemas",
  title: "Biodiversidad y Ecosistemas: Una Guía Completa",
  description: "Aprende sobre la increíble diversidad de vida en nuestro planeta, cómo funcionan los ecosistemas y qué podemos hacer para protegerlos.",
  thumbnail_url: "https://images.unsplash.com/photo-1441974231531-c6227db76b6e?auto=format&fit=crop&w=600&h=400",
  estimated_duration: 120,
  difficulty_level: "intermedio",
  categories: [
    { id: 1, name: "Ecología" },
    { id: 2, name: "Conservación" }
  ],
  lessons: [
    { id: 1, title: "Introducción a la Biodiversidad", estimated_duration: 15 },
    { id: 2, title: "Tipos de Ecosistemas", estimated_duration: 20 },
    { id: 3, title: "Cadenas Alimenticias", estimated_duration: 18 },
    { id: 4, title: "Impacto Humano", estimated_duration: 25 },
    { id: 5, title: "Conservación y Sostenibilidad", estimated_duration: 22 },
    { id: 6, title: "Proyecto Final", estimated_duration: 20 },
  ],
  author: {
    full_name: "Dra. María García",
    avatar: "https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=200&h=200&fit=crop"
  },
  course_details: {
    goals: [
      "Comprender qué es la biodiversidad y su importancia",
      "Identificar los diferentes tipos de ecosistemas",
      "Analizar el impacto de las actividades humanas",
      "Desarrollar estrategias de conservación"
    ],
    completion_points: 500
  },
  enrollment: {
    progress_percentage: 35
  },
  lesson_progress: {
    1: { status: "completed" },
    2: { status: "completed" }
  }
};

const CourseDetail = () => {
  const { slug } = useParams<{ slug: string }>();
  const navigate = useNavigate();
  const [content, setContent] = useState<EducationalContent | null>(null);
  const [loading, setLoading] = useState(true);
  const [starting, setStarting] = useState(false);

  useEffect(() => {
    // Simulating API call - replace with actual API call
    const fetchContent = async () => {
      try {
        // const data = await getEducationalContent(slug);
        // setContent(data);
        
        // Using mock data for demo
        setTimeout(() => {
          setContent(mockCourse);
          setLoading(false);
        }, 500);
      } catch (error) {
        console.error("Error fetching course:", error);
        setLoading(false);
      }
    };
    fetchContent();
  }, [slug]);

  const handleStartContinue = async () => {
    if (!content) return;
    setStarting(true);
    try {
      let targetLessonId;
      if (content.lessons && content.lessons.length > 0) {
        const firstIncomplete = content.lessons.find(l => {
          const progress = content.lesson_progress?.[l.id];
          return !progress || progress.status !== "completed";
        });
        targetLessonId = firstIncomplete ? firstIncomplete.id : content.lessons[0].id;
      }

      if (targetLessonId) {
        navigate(`/learn/course/${content.slug}/lesson/${targetLessonId}`);
      }
    } finally {
      setStarting(false);
    }
  };

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-background">
        <motion.div
          animate={{ rotate: 360 }}
          transition={{ duration: 1, repeat: Infinity, ease: "linear" }}
          className="w-8 h-8 border-2 border-primary border-t-transparent rounded-full"
        />
      </div>
    );
  }

  if (!content) {
    return (
      <div className="min-h-screen flex flex-col items-center justify-center bg-background gap-4">
        <BookOpen className="w-16 h-16 text-muted-foreground" />
        <p className="text-xl text-muted-foreground">Curso no encontrado</p>
        <Link to="/learn">
          <Button variant="outline">Volver al Centro de Aprendizaje</Button>
        </Link>
      </div>
    );
  }

  const imageUrl = content.thumbnail_url || "https://images.unsplash.com/photo-1441974231531-c6227db76b6e?auto=format&fit=crop&w=600&h=400";
  const totalLessons = content.lessons?.length || 0;
  const isEnrolled = !!content.enrollment;
  const progressPercentage = content.enrollment?.progress_percentage || 0;
  const completedLessons = Object.values(content.lesson_progress || {}).filter(
    p => p.status === "completed"
  ).length;

  return (
    <div className="min-h-screen bg-background">
      {/* Navigation */}
      <motion.nav
        initial={{ y: -20, opacity: 0 }}
        animate={{ y: 0, opacity: 1 }}
        className="sticky top-0 z-50 bg-background/80 backdrop-blur-xl border-b border-border/50"
      >
        <div className="container mx-auto px-4 sm:px-6 h-16 flex items-center justify-between">
          <Link to="/learn">
            <Button variant="ghost" size="sm" className="gap-2">
              <ChevronLeft className="w-4 h-4" />
              <span className="hidden sm:inline">Volver al Centro de Aprendizaje</span>
              <span className="sm:hidden">Volver</span>
            </Button>
          </Link>
        </div>
      </motion.nav>

      {/* Hero Section */}
      <section className="relative overflow-hidden">
        <div className="absolute inset-0 bg-gradient-to-br from-primary/5 via-transparent to-accent/5" />
        
        <div className="container mx-auto px-4 sm:px-6 py-8 sm:py-12 lg:py-16 relative">
          <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12 items-center">
            {/* Content */}
            <motion.div
              initial={{ opacity: 0, x: -20 }}
              animate={{ opacity: 1, x: 0 }}
              transition={{ duration: 0.5 }}
              className="space-y-6 order-2 lg:order-1"
            >
              {/* Categories */}
              <div className="flex flex-wrap gap-2">
                {content.categories?.map(cat => (
                  <motion.span
                    key={cat.id}
                    initial={{ opacity: 0, scale: 0.9 }}
                    animate={{ opacity: 1, scale: 1 }}
                    className="px-3 py-1.5 text-xs font-semibold bg-primary/10 text-primary rounded-full"
                  >
                    {cat.name}
                  </motion.span>
                ))}
              </div>

              {/* Title */}
              <h1 className="text-3xl sm:text-4xl lg:text-5xl font-bold text-foreground leading-tight">
                {content.title}
              </h1>

              {/* Description */}
              <p className="text-lg text-muted-foreground leading-relaxed">
                {content.description}
              </p>

              {/* Stats */}
              <div className="flex flex-wrap gap-4 sm:gap-6 text-sm">
                <div className="flex items-center gap-2 text-muted-foreground">
                  <Clock className="w-4 h-4 text-primary" />
                  <span>{content.estimated_duration} min</span>
                </div>
                <div className="flex items-center gap-2 text-muted-foreground">
                  <BookOpen className="w-4 h-4 text-primary" />
                  <span>{totalLessons} lecciones</span>
                </div>
                <div className="flex items-center gap-2 text-muted-foreground">
                  <Tag className="w-4 h-4 text-primary" />
                  <span className="capitalize">{content.difficulty_level}</span>
                </div>
                <div className="flex items-center gap-2 text-muted-foreground">
                  <Users className="w-4 h-4 text-primary" />
                  <span>1.2k estudiantes</span>
                </div>
              </div>

              {/* CTA */}
              <div className="pt-4 space-y-4">
                <Button
                  size="lg"
                  onClick={handleStartContinue}
                  disabled={starting}
                  className="w-full sm:w-auto text-lg px-8 py-6 rounded-xl shadow-lg shadow-primary/25 gradient-primary hover:opacity-90 transition-all duration-300"
                >
                  <PlayCircle className="w-5 h-5 mr-2" />
                  {starting ? "Cargando..." : isEnrolled ? "Continuar Aprendiendo" : "Comenzar Gratis"}
                </Button>

                {isEnrolled && (
                  <motion.div
                    initial={{ opacity: 0, y: 10 }}
                    animate={{ opacity: 1, y: 0 }}
                    className="max-w-sm"
                  >
                    <CourseProgress progress={progressPercentage} />
                    <p className="text-xs text-muted-foreground mt-2">
                      {completedLessons} de {totalLessons} lecciones completadas
                    </p>
                  </motion.div>
                )}
              </div>
            </motion.div>

            {/* Image */}
            <motion.div
              initial={{ opacity: 0, scale: 0.95 }}
              animate={{ opacity: 1, scale: 1 }}
              transition={{ duration: 0.5, delay: 0.1 }}
              className="order-1 lg:order-2"
            >
              <div className="relative aspect-video lg:aspect-[4/3] rounded-2xl lg:rounded-3xl overflow-hidden shadow-2xl group">
                <img
                  src={imageUrl}
                  alt={content.title}
                  className="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
                />
                <div className="absolute inset-0 bg-gradient-to-t from-foreground/60 via-transparent to-transparent" />
                <div className="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                  <div className="w-16 h-16 sm:w-20 sm:h-20 rounded-full bg-background/20 backdrop-blur-lg flex items-center justify-center">
                    <PlayCircle className="w-8 h-8 sm:w-10 sm:h-10 text-background" />
                  </div>
                </div>
                
                {/* Rating badge */}
                <div className="absolute top-4 right-4 px-3 py-1.5 rounded-full bg-background/90 backdrop-blur-sm flex items-center gap-1">
                  <Star className="w-4 h-4 text-warning fill-warning" />
                  <span className="text-sm font-semibold">4.8</span>
                </div>
              </div>
            </motion.div>
          </div>
        </div>
      </section>

      {/* Main Content */}
      <section className="container mx-auto px-4 sm:px-6 py-8 sm:py-12">
        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
          {/* Left Column - Course Content */}
          <div className="lg:col-span-2 space-y-8">
            {/* About */}
            <motion.div
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: 0.2 }}
              className="glass-card p-6 sm:p-8 rounded-2xl"
            >
              <h3 className="text-xl sm:text-2xl font-bold mb-4">Acerca de este curso</h3>
              <div 
                className="prose prose-sm sm:prose text-muted-foreground max-w-none"
                dangerouslySetInnerHTML={{ 
                  __html: content.article_details?.content_text || content.description 
                }} 
              />
            </motion.div>

            {/* Lessons */}
            <motion.div
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: 0.3 }}
              className="glass-card p-6 sm:p-8 rounded-2xl"
            >
              <div className="flex items-center justify-between mb-6">
                <h3 className="text-xl sm:text-2xl font-bold">Contenido del Curso</h3>
                <span className="text-sm text-muted-foreground">
                  {totalLessons} lecciones • {content.estimated_duration} min
                </span>
              </div>
              <div className="space-y-3">
                {content.lessons?.map((lesson, index) => {
                  const lessonProgress = content.lesson_progress?.[lesson.id];
                  const isCompleted = lessonProgress?.status === "completed";
                  const isLocked = !isEnrolled && index > 0;

                  return (
                    <LessonCard
                      key={lesson.id}
                      index={index}
                      title={lesson.title}
                      duration={lesson.estimated_duration}
                      isCompleted={isCompleted}
                      isLocked={isLocked}
                      onClick={() => navigate(`/learn/course/${content.slug}/lesson/${lesson.id}`)}
                    />
                  );
                })}
              </div>
            </motion.div>
          </div>

          {/* Right Column - Sidebar */}
          <div className="space-y-6">
            {/* Author Card */}
            {content.author && (
              <motion.div
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ delay: 0.4 }}
                className="glass-card p-6 rounded-2xl text-center"
              >
                <div className="relative inline-block mb-4">
                  <img
                    src={content.author.avatar || "/placeholder-avatar.png"}
                    alt={content.author.full_name}
                    className="w-20 h-20 rounded-full object-cover ring-4 ring-primary/20"
                  />
                  <div className="absolute -bottom-1 -right-1 w-6 h-6 bg-primary rounded-full flex items-center justify-center">
                    <CheckCircle2 className="w-4 h-4 text-primary-foreground" />
                  </div>
                </div>
                <h4 className="font-semibold text-foreground">{content.author.full_name}</h4>
                <p className="text-sm text-muted-foreground mb-4">Educador Verificado</p>
                <div className="flex justify-center gap-4 text-sm text-muted-foreground">
                  <div className="text-center">
                    <p className="font-bold text-foreground">12</p>
                    <p className="text-xs">Cursos</p>
                  </div>
                  <div className="text-center">
                    <p className="font-bold text-foreground">5.2k</p>
                    <p className="text-xs">Estudiantes</p>
                  </div>
                </div>
              </motion.div>
            )}

            {/* Goals Card */}
            {content.course_details?.goals && (
              <motion.div
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ delay: 0.5 }}
                className="glass-card p-6 rounded-2xl"
              >
                <h4 className="font-semibold mb-4 flex items-center gap-2">
                  <Award className="w-5 h-5 text-primary" />
                  Lo que aprenderás
                </h4>
                <ul className="space-y-3">
                  {content.course_details.goals.map((goal, i) => (
                    <li key={i} className="flex gap-3 text-sm text-muted-foreground">
                      <CheckCircle2 className="w-4 h-4 text-success shrink-0 mt-0.5" />
                      <span>{goal}</span>
                    </li>
                  ))}
                </ul>
              </motion.div>
            )}

            {/* Points Card */}
            {content.course_details?.completion_points && (
              <motion.div
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ delay: 0.6 }}
                className="gradient-primary p-6 rounded-2xl text-primary-foreground"
              >
                <div className="flex items-center gap-4">
                  <div className="w-12 h-12 rounded-full bg-primary-foreground/20 flex items-center justify-center">
                    <Trophy className="w-6 h-6" />
                  </div>
                  <div>
                    <p className="text-2xl font-bold">{content.course_details.completion_points}</p>
                    <p className="text-sm opacity-90">Puntos al completar</p>
                  </div>
                </div>
              </motion.div>
            )}
          </div>
        </div>
      </section>
    </div>
  );
};

export default CourseDetail;


import { useEffect, useState } from "react";
import { useParams, Link, useNavigate } from "react-router-dom";
import { motion, AnimatePresence } from "framer-motion";
import { Button } from "@/components/ui/button";
import { 
  ChevronLeft, 
  ChevronRight,
  CheckCircle2, 
  Menu, 
  X,
  BookOpen,
  ArrowRight
} from "lucide-react";
import { cn } from "@/lib/utils";
import { CourseSidebar } from "@/components/learn/CourseSidebar";
import { VideoPlayer } from "@/components/learn/VideoPlayer";
import { CourseProgress } from "@/components/learn/CourseProgress";
import { ScrollArea } from "@/components/ui/scroll-area";

// Types
interface Activity {
  id: number;
  title: string;
  type: string;
}

interface Reference {
  id: number;
  title: string;
  url: string;
}

interface Lesson {
  id: number;
  title: string;
  estimated_duration: number;
  content_text?: string;
  media_url?: string;
  activities?: Activity[];
  references?: Reference[];
}

interface EducationalContent {
  slug: string;
  title: string;
  lessons?: Lesson[];
  enrollment?: {
    progress_percentage: number;
  };
  lesson_progress?: Record<number, { status: string }>;
}

// Mock data
const mockCourse: EducationalContent = {
  slug: "biodiversidad-ecosistemas",
  title: "Biodiversidad y Ecosistemas",
  lessons: [
    { 
      id: 1, 
      title: "Introducción a la Biodiversidad", 
      estimated_duration: 15,
      content_text: `
        <h2>¿Qué es la Biodiversidad?</h2>
        <p>La biodiversidad, o diversidad biológica, se refiere a la variedad de formas de vida que existen en nuestro planeta. Esta incluye todos los seres vivos, desde las bacterias más pequeñas hasta los animales más grandes, así como los ecosistemas en los que habitan.</p>
        
        <h3>Niveles de Biodiversidad</h3>
        <p>La biodiversidad se puede estudiar en tres niveles principales:</p>
        <ul>
          <li><strong>Diversidad genética:</strong> La variación de genes dentro de una especie.</li>
          <li><strong>Diversidad de especies:</strong> La variedad de especies en un área determinada.</li>
          <li><strong>Diversidad de ecosistemas:</strong> La variedad de ecosistemas en una región.</li>
        </ul>
        
        <h3>Importancia de la Biodiversidad</h3>
        <p>La biodiversidad es esencial para el funcionamiento de los ecosistemas y proporciona numerosos servicios que benefician a la humanidad, incluyendo:</p>
        <ul>
          <li>Producción de oxígeno y purificación del aire</li>
          <li>Regulación del clima</li>
          <li>Provisión de alimentos y medicinas</li>
          <li>Control natural de plagas</li>
          <li>Polinización de cultivos</li>
        </ul>
      `,
      media_url: "https://example.com/video1.mp4",
      activities: [
        { id: 1, title: "Quiz: Conceptos básicos", type: "quiz" }
      ],
      references: [
        { id: 1, title: "WWF - What is Biodiversity?", url: "https://wwf.org" }
      ]
    },
    { 
      id: 2, 
      title: "Tipos de Ecosistemas", 
      estimated_duration: 20,
      content_text: "<p>Contenido sobre tipos de ecosistemas...</p>"
    },
    { 
      id: 3, 
      title: "Cadenas Alimenticias", 
      estimated_duration: 18,
      content_text: "<p>Contenido sobre cadenas alimenticias...</p>"
    },
    { 
      id: 4, 
      title: "Impacto Humano", 
      estimated_duration: 25,
      content_text: "<p>Contenido sobre impacto humano...</p>"
    },
    { 
      id: 5, 
      title: "Conservación y Sostenibilidad", 
      estimated_duration: 22,
      content_text: "<p>Contenido sobre conservación...</p>"
    },
  ],
  enrollment: {
    progress_percentage: 35
  },
  lesson_progress: {
    1: { status: "completed" },
    2: { status: "completed" }
  }
};

const LessonPlayer = () => {
  const { courseSlug, lessonId } = useParams<{ courseSlug: string; lessonId: string }>();
  const navigate = useNavigate();
  const [course, setCourse] = useState<EducationalContent | null>(null);
  const [loading, setLoading] = useState(true);
  const [sidebarOpen, setSidebarOpen] = useState(false);
  const [completing, setCompleting] = useState(false);

  useEffect(() => {
    const fetchContent = async () => {
      try {
        // Replace with actual API call
        setTimeout(() => {
          setCourse(mockCourse);
          setLoading(false);
        }, 500);
      } catch (error) {
        console.error("Error fetching course:", error);
        setLoading(false);
      }
    };
    fetchContent();
  }, [courseSlug]);

  // Close sidebar on larger screens
  useEffect(() => {
    const handleResize = () => {
      if (window.innerWidth >= 1024) {
        setSidebarOpen(true);
      }
    };
    handleResize();
    window.addEventListener("resize", handleResize);
    return () => window.removeEventListener("resize", handleResize);
  }, []);

  if (loading) {
    return (
      <div className="h-screen flex items-center justify-center bg-background">
        <motion.div
          animate={{ rotate: 360 }}
          transition={{ duration: 1, repeat: Infinity, ease: "linear" }}
          className="w-8 h-8 border-2 border-primary border-t-transparent rounded-full"
        />
      </div>
    );
  }

  if (!course) {
    return (
      <div className="h-screen flex flex-col items-center justify-center bg-background gap-4">
        <BookOpen className="w-16 h-16 text-muted-foreground" />
        <p className="text-xl text-muted-foreground">Curso no encontrado</p>
      </div>
    );
  }

  const currentLesson = course.lessons?.find(l => l.id === Number(lessonId));
  const currentLessonIndex = course.lessons?.findIndex(l => l.id === Number(lessonId)) ?? -1;
  const nextLesson = course.lessons?.[currentLessonIndex + 1];
  const previousLesson = course.lessons?.[currentLessonIndex - 1];

  if (!currentLesson) {
    return (
      <div className="h-screen flex flex-col items-center justify-center bg-background gap-4">
        <BookOpen className="w-16 h-16 text-muted-foreground" />
        <p className="text-xl text-muted-foreground">Lección no encontrada</p>
        <Link to={`/learn/course/${courseSlug}`}>
          <Button variant="outline">Volver al curso</Button>
        </Link>
      </div>
    );
  }

  const handleLessonComplete = async () => {
    setCompleting(true);
    try {
      // await completeLesson(currentLesson.id);
      // Simulating completion
      await new Promise(resolve => setTimeout(resolve, 500));
      
      if (nextLesson) {
        navigate(`/learn/course/${courseSlug}/lesson/${nextLesson.id}`);
      } else {
        navigate(`/learn/course/${courseSlug}`);
      }
    } catch (error) {
      console.error("Error completing lesson:", error);
    } finally {
      setCompleting(false);
    }
  };

  const isLessonCompleted = (id: number) => {
    return course.lesson_progress?.[id]?.status === "completed";
  };

  const isCurrentLessonCompleted = isLessonCompleted(currentLesson.id);

  return (
    <div className="h-screen flex flex-col overflow-hidden bg-background">
      {/* Top Header */}
      <motion.header
        initial={{ y: -20, opacity: 0 }}
        animate={{ y: 0, opacity: 1 }}
        className="h-14 sm:h-16 border-b border-border flex items-center justify-between px-4 bg-background/95 backdrop-blur-sm z-30 shrink-0"
      >
        <div className="flex items-center gap-2 sm:gap-4 min-w-0">
          <Button
            variant="ghost"
            size="icon"
            className="lg:hidden shrink-0"
            onClick={() => setSidebarOpen(!sidebarOpen)}
          >
            {sidebarOpen ? <X className="w-5 h-5" /> : <Menu className="w-5 h-5" />}
          </Button>
          
          <Link to={`/learn/course/${courseSlug}`} className="shrink-0">
            <Button variant="ghost" size="sm" className="gap-1 sm:gap-2">
              <ChevronLeft className="w-4 h-4" />
              <span className="hidden sm:inline">Volver</span>
            </Button>
          </Link>

          <div className="hidden md:block h-6 w-px bg-border" />

          <h1 className="font-semibold text-sm sm:text-base truncate hidden md:block max-w-[300px] lg:max-w-md">
            {course.title}
          </h1>
        </div>

        <div className="flex items-center gap-3">
          <div className="hidden sm:flex items-center gap-2 text-sm text-muted-foreground">
            <span>Lección {currentLessonIndex + 1} de {course.lessons?.length}</span>
          </div>
          <div className="hidden md:block w-32">
            <CourseProgress 
              progress={course.enrollment?.progress_percentage || 0} 
              size="sm" 
              showLabel={false}
            />
          </div>
        </div>
      </motion.header>

      <div className="flex flex-1 overflow-hidden">
        {/* Sidebar */}
        <CourseSidebar
          courseSlug={courseSlug || ""}
          courseTitle={course.title}
          lessons={course.lessons || []}
          currentLessonId={currentLesson.id}
          lessonProgress={course.lesson_progress || {}}
          progressPercentage={course.enrollment?.progress_percentage || 0}
          isOpen={sidebarOpen}
          onClose={() => setSidebarOpen(false)}
        />

        {/* Main Content */}
        <main className="flex-1 overflow-hidden flex flex-col min-w-0">
          <ScrollArea className="flex-1">
            <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8 lg:py-12">
              {/* Lesson Header */}
              <motion.div
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                className="mb-6 sm:mb-8"
              >
                <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                  <div>
                    <p className="text-sm text-primary font-medium mb-1">
                      Lección {currentLessonIndex + 1}
                    </p>
                    <h2 className="text-2xl sm:text-3xl font-bold text-foreground">
                      {currentLesson.title}
                    </h2>
                  </div>
                  {isCurrentLessonCompleted && (
                    <motion.div
                      initial={{ scale: 0 }}
                      animate={{ scale: 1 }}
                      className="flex items-center gap-2 px-3 py-1.5 bg-success/10 text-success rounded-full text-sm font-medium self-start sm:self-auto"
                    >
                      <CheckCircle2 className="w-4 h-4" />
                      Completada
                    </motion.div>
                  )}
                </div>
              </motion.div>

              {/* Video Player */}
              {currentLesson.media_url && (
                <motion.div
                  initial={{ opacity: 0, scale: 0.98 }}
                  animate={{ opacity: 1, scale: 1 }}
                  transition={{ delay: 0.1 }}
                  className="mb-8"
                >
                  <VideoPlayer 
                    mediaUrl={currentLesson.media_url} 
                    title={currentLesson.title}
                  />
                </motion.div>
              )}

              {/* Lesson Content */}
              <motion.div
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ delay: 0.2 }}
                className="prose prose-sm sm:prose lg:prose-lg max-w-none mb-8"
              >
                <div 
                  className="text-foreground [&>h2]:text-2xl [&>h2]:font-bold [&>h2]:mt-8 [&>h2]:mb-4 [&>h3]:text-xl [&>h3]:font-semibold [&>h3]:mt-6 [&>h3]:mb-3 [&>p]:text-muted-foreground [&>p]:leading-relaxed [&>p]:mb-4 [&>ul]:space-y-2 [&>ul]:my-4 [&>ul>li]:text-muted-foreground [&>ul>li]:pl-2"
                  dangerouslySetInnerHTML={{ __html: currentLesson.content_text || "" }}
                />
              </motion.div>

              {/* Activities Section */}
              {currentLesson.activities && currentLesson.activities.length > 0 && (
                <motion.div
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ delay: 0.3 }}
                  className="mb-8"
                >
                  <h3 className="text-xl font-bold mb-4">Actividades</h3>
                  <div className="space-y-3">
                    {currentLesson.activities.map((activity) => (
                      <div
                        key={activity.id}
                        className="p-4 rounded-xl border border-border bg-card hover:border-primary/50 hover:shadow-md transition-all cursor-pointer"
                      >
                        <div className="flex items-center justify-between">
                          <div>
                            <p className="font-medium">{activity.title}</p>
                            <p className="text-sm text-muted-foreground capitalize">{activity.type}</p>
                          </div>
                          <ArrowRight className="w-5 h-5 text-muted-foreground" />
                        </div>
                      </div>
                    ))}
                  </div>
                </motion.div>
              )}

              {/* References Section */}
              {currentLesson.references && currentLesson.references.length > 0 && (
                <motion.div
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ delay: 0.4 }}
                  className="mb-8"
                >
                  <h3 className="text-xl font-bold mb-4">Referencias</h3>
                  <div className="space-y-2">
                    {currentLesson.references.map((ref) => (
                      <a
                        key={ref.id}
                        href={ref.url}
                        target="_blank"
                        rel="noopener noreferrer"
                        className="block p-3 rounded-lg border border-border hover:bg-muted/50 transition-colors"
                      >
                        <p className="text-sm text-primary hover:underline">{ref.title}</p>
                      </a>
                    ))}
                  </div>
                </motion.div>
              )}

              {/* Navigation Footer */}
              <motion.div
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ delay: 0.5 }}
                className="flex flex-col sm:flex-row items-stretch sm:items-center justify-between gap-4 pt-8 border-t border-border"
              >
                <div>
                  {previousLesson && (
                    <Button
                      variant="outline"
                      onClick={() => navigate(`/learn/course/${courseSlug}/lesson/${previousLesson.id}`)}
                      className="w-full sm:w-auto"
                    >
                      <ChevronLeft className="w-4 h-4 mr-2" />
                      Anterior
                    </Button>
                  )}
                </div>

                <div className="flex flex-col sm:flex-row gap-3">
                  {!isCurrentLessonCompleted && (
                    <Button
                      variant="outline"
                      onClick={handleLessonComplete}
                      disabled={completing}
                      className="w-full sm:w-auto"
                    >
                      {completing ? (
                        <motion.div
                          animate={{ rotate: 360 }}
                          transition={{ duration: 1, repeat: Infinity, ease: "linear" }}
                          className="w-4 h-4 border-2 border-current border-t-transparent rounded-full mr-2"
                        />
                      ) : (
                        <CheckCircle2 className="w-4 h-4 mr-2" />
                      )}
                      Marcar como Completada
                    </Button>
                  )}
                  
                  {nextLesson && (
                    <Button
                      onClick={() => navigate(`/learn/course/${courseSlug}/lesson/${nextLesson.id}`)}
                      className="w-full sm:w-auto gradient-primary"
                    >
                      Siguiente Lección
                      <ChevronRight className="w-4 h-4 ml-2" />
                    </Button>
                  )}

                  {!nextLesson && (
                    <Button
                      onClick={() => navigate(`/learn/course/${courseSlug}`)}
                      className="w-full sm:w-auto gradient-primary"
                    >
                      Finalizar Curso
                      <CheckCircle2 className="w-4 h-4 ml-2" />
                    </Button>
                  )}
                </div>
              </motion.div>
            </div>
          </ScrollArea>
        </main>
      </div>
    </div>
  );
};

export default LessonPlayer;


compontentes

import { motion } from "framer-motion";
import { cn } from "@/lib/utils";

interface CourseProgressProps {
  progress: number;
  size?: "sm" | "md" | "lg";
  showLabel?: boolean;
  className?: string;
}

export const CourseProgress = ({ 
  progress, 
  size = "md", 
  showLabel = true,
  className 
}: CourseProgressProps) => {
  const heights = {
    sm: "h-1.5",
    md: "h-2.5",
    lg: "h-4",
  };

  return (
    <div className={cn("w-full", className)}>
      {showLabel && (
        <div className="flex justify-between items-center mb-2">
          <span className="text-xs font-medium text-muted-foreground">Tu progreso</span>
          <span className="text-xs font-bold text-primary">{Math.round(progress)}%</span>
        </div>
      )}
      <div className={cn("w-full bg-progress rounded-full overflow-hidden", heights[size])}>
        <motion.div
          className={cn("h-full bg-progress-fill rounded-full", heights[size])}
          initial={{ width: 0 }}
          animate={{ width: `${progress}%` }}
          transition={{ duration: 0.8, ease: "easeOut" }}
        />
      </div>
    </div>
  );
};


import { motion, AnimatePresence } from "framer-motion";
import { Link } from "react-router-dom";
import { CheckCircle2, Lock, PlayCircle, X } from "lucide-react";
import { cn } from "@/lib/utils";
import { Button } from "@/components/ui/button";
import { CourseProgress } from "./CourseProgress";
import { ScrollArea } from "@/components/ui/scroll-area";

interface Lesson {
  id: number;
  title: string;
  estimated_duration: number;
}

interface CourseSidebarProps {
  courseSlug: string;
  courseTitle: string;
  lessons: Lesson[];
  currentLessonId: number;
  lessonProgress: Record<number, { status: string }>;
  progressPercentage: number;
  isOpen: boolean;
  onClose: () => void;
}

export const CourseSidebar = ({
  courseSlug,
  courseTitle,
  lessons,
  currentLessonId,
  lessonProgress,
  progressPercentage,
  isOpen,
  onClose,
}: CourseSidebarProps) => {
  const isLessonCompleted = (lessonId: number) => {
    return lessonProgress[lessonId]?.status === "completed";
  };

  const sidebarContent = (
    <div className="flex flex-col h-full">
      {/* Header */}
      <div className="p-4 border-b border-sidebar-border bg-sidebar">
        <div className="flex items-center justify-between mb-4">
          <h3 className="font-semibold text-sidebar-foreground text-sm truncate pr-2">
            {courseTitle}
          </h3>
          <Button
            variant="ghost"
            size="icon"
            className="shrink-0 lg:hidden"
            onClick={onClose}
          >
            <X className="w-4 h-4" />
          </Button>
        </div>
        <CourseProgress progress={progressPercentage} size="sm" />
      </div>

      {/* Lessons List */}
      <ScrollArea className="flex-1">
        <div className="p-2">
          {lessons.map((lesson, idx) => {
            const active = lesson.id === currentLessonId;
            const completed = isLessonCompleted(lesson.id);
            const locked =
              !completed &&
              idx > 0 &&
              !isLessonCompleted(lessons[idx - 1].id);

            return (
              <Link
                key={lesson.id}
                to={locked ? "#" : `/learn/course/${courseSlug}/lesson/${lesson.id}`}
                onClick={(e) => {
                  if (locked) e.preventDefault();
                  if (!locked && window.innerWidth < 1024) onClose();
                }}
                className={cn(
                  "flex items-center gap-3 p-3 rounded-lg mb-1 transition-all duration-200",
                  active && "bg-sidebar-accent text-sidebar-accent-foreground",
                  !active && !locked && "hover:bg-sidebar-accent/50",
                  locked && "opacity-50 cursor-not-allowed"
                )}
              >
                <div className="shrink-0">
                  {completed ? (
                    <div className="w-6 h-6 rounded-full bg-success/20 flex items-center justify-center">
                      <CheckCircle2 className="w-4 h-4 text-success" />
                    </div>
                  ) : locked ? (
                    <div className="w-6 h-6 rounded-full bg-muted flex items-center justify-center">
                      <Lock className="w-3 h-3 text-muted-foreground" />
                    </div>
                  ) : active ? (
                    <div className="w-6 h-6 rounded-full bg-primary flex items-center justify-center">
                      <PlayCircle className="w-4 h-4 text-primary-foreground" />
                    </div>
                  ) : (
                    <div className="w-6 h-6 rounded-full bg-secondary flex items-center justify-center text-xs font-medium">
                      {idx + 1}
                    </div>
                  )}
                </div>
                <div className="min-w-0 flex-1">
                  <p
                    className={cn(
                      "text-sm font-medium truncate",
                      active ? "text-sidebar-primary" : "text-sidebar-foreground"
                    )}
                  >
                    {lesson.title}
                  </p>
                  <p className="text-xs text-muted-foreground">
                    {lesson.estimated_duration} min
                  </p>
                </div>
              </Link>
            );
          })}
        </div>
      </ScrollArea>
    </div>
  );

  return (
    <>
      {/* Mobile overlay */}
      <AnimatePresence>
        {isOpen && (
          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            className="fixed inset-0 bg-background/80 backdrop-blur-sm z-40 lg:hidden"
            onClick={onClose}
          />
        )}
      </AnimatePresence>

      {/* Sidebar */}
      <motion.aside
        initial={false}
        animate={{
          x: isOpen ? 0 : "-100%",
        }}
        transition={{ type: "spring", damping: 25, stiffness: 200 }}
        className={cn(
          "fixed lg:relative z-50 lg:z-auto",
          "w-[280px] lg:w-72 h-full",
          "bg-sidebar border-r border-sidebar-border",
          "lg:translate-x-0"
        )}
      >
        {sidebarContent}
      </motion.aside>
    </>
  );
};


import { motion } from "framer-motion";
import { CheckCircle2, Lock, PlayCircle, Clock } from "lucide-react";
import { cn } from "@/lib/utils";

interface LessonCardProps {
  index: number;
  title: string;
  duration: number;
  isCompleted: boolean;
  isLocked: boolean;
  isActive?: boolean;
  onClick?: () => void;
}

export const LessonCard = ({
  index,
  title,
  duration,
  isCompleted,
  isLocked,
  isActive = false,
  onClick,
}: LessonCardProps) => {
  return (
    <motion.div
      initial={{ opacity: 0, y: 10 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ delay: index * 0.05 }}
      onClick={!isLocked ? onClick : undefined}
      className={cn(
        "group flex items-center gap-4 p-4 rounded-xl border transition-all duration-300 cursor-pointer",
        isCompleted && "border-success/30 bg-success/5",
        isActive && "border-primary bg-primary/5 ring-2 ring-primary/20",
        isLocked && "opacity-60 cursor-not-allowed",
        !isCompleted && !isActive && !isLocked && "border-border hover:border-primary/50 hover:bg-muted/50 hover:shadow-md"
      )}
    >
      <div
        className={cn(
          "w-10 h-10 rounded-full flex items-center justify-center font-bold text-sm shrink-0 transition-all duration-300",
          isCompleted && "bg-success/20 text-success",
          isActive && "bg-primary text-primary-foreground",
          isLocked && "bg-muted text-muted-foreground",
          !isCompleted && !isActive && !isLocked && "bg-secondary text-secondary-foreground group-hover:bg-primary/10 group-hover:text-primary"
        )}
      >
        {isCompleted ? (
          <CheckCircle2 className="w-5 h-5" />
        ) : isLocked ? (
          <Lock className="w-4 h-4" />
        ) : isActive ? (
          <PlayCircle className="w-5 h-5" />
        ) : (
          index + 1
        )}
      </div>

      <div className="flex-1 min-w-0">
        <h4
          className={cn(
            "font-medium text-foreground truncate transition-colors",
            isActive && "text-primary",
            isLocked && "text-muted-foreground"
          )}
        >
          {title}
        </h4>
        <div className="flex items-center gap-2 mt-1">
          <Clock className="w-3 h-3 text-muted-foreground" />
          <span className="text-xs text-muted-foreground">{duration} min</span>
        </div>
      </div>

      {isCompleted && (
        <motion.div
          initial={{ scale: 0 }}
          animate={{ scale: 1 }}
          className="px-2.5 py-1 bg-success/10 text-success text-xs font-medium rounded-full"
        >
          Completado
        </motion.div>
      )}

      {!isLocked && !isCompleted && (
        <motion.div
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          className="opacity-0 group-hover:opacity-100 transition-opacity"
        >
          <PlayCircle className="w-5 h-5 text-primary" />
        </motion.div>
      )}
    </motion.div>
  );
};
